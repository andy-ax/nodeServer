<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p>已连接</p>
<button onclick="send()">获取数据</button>
<ul id="list">

</ul>
<script>
    function loopReadsData(url, callback) {//comet HTTP流
        var xhr = new XMLHttpRequest();
        var received = 0;
        xhr.open('GET',url,true);
        xhr.onreadystatechange = function () {
            var result;
            if(xhr.readyState === 3){
                result = xhr.responseText.substring(received);
                received += result.length;
                callback(result);
                if(result.length > 5){
                    result = '';
                    received = 0;
                }
            }
        };
        xhr.send(null);
    }
    function send() {
        loopReadsData('/getdata',function (data) {
            var list = document.querySelector('#list');
            var li = document.createElement('li');
            li.innerHTML = data;
            list.appendChild(li);
        });
    }
    function end() {

    }
</script>
</body>
</html>
